# SLI-SLO-SLA

关键术语：
- 服务水平指标(SLI): 用于衡量提供给最终用户的服务水平的指标（例如，可用性、延迟、吞吐量）。
- 服务水平目标(SLO): 目标服务级别，由 SLI 衡量。它们通常表示为一段时间内的百分比。
- 服务水平协议(SLA): 合同协议，概述了最终用户可以从服务提供商处获得的服务水平。 如果这些承诺没有兑现，供应商可能会面临重大后果，这些后果通常是财务性质的（例如，服务信用、订阅延期）。 错误预算是服务在不符合 SLO 之前可接受的不可靠性水平。简而言之，它们是 100% 可靠性和 SLO 目标之间的差异。 您可以将错误预算视为财务预算——但在这种情况下，开发人员将预算用于构建新功能、重新设计系统架构或任何其他产品开发工作。

## SLI选择

所有SLI都是指标，但并非所有指标都是好的SLI,选择最能捕捉用户体验的指标。

常见SLI分类：

![image_26.png](image_26.png)

### 1.API服务
- **吞吐量**  
  - `QPS`（任意5分钟窗口）
- **可用性**  
  - `服务可用率`（28天滚动窗口）  
    - *定义：* (1 - (5xx错误 + 超时失败请求数) / 总请求数)
- **延迟**  
  - `核心链路 P95P99 `（1小时滚动窗口，按流量加权）
  - `常规接口 P95P99 `（1小时滚动窗口，按流量加权）

### 2.数据服务
- **吞吐量**  
  - `QPS`（任意5分钟窗口）
- **可用性**  
  - `查询可用率`（28天滚动窗口）  
    - *定义：* (1 - (5xx错误 + 超时失败) / 总查询请求数)  
  - `数据有效性`（28天滚动窗口）  
    - *定义：* (返回数据通过完整性校验的请求数 / 成功响应请求数)  
- **延迟**  
  - `实时查询 P95延迟`（1小时滚动窗口）  
  - `离线查询 P95延迟`（24小时滚动窗口）
- **数据时效性**  
  - `端到端数据延迟 P99`（1小时滚动窗口）  
    - *定义：* 从数据产生到可查询的耗时  

## SLO 制
![image_25.png](image_25.png)

SLO 应该：
· 可实现
· 可重复
· 可衡量
· 可理解
· 有意义
· 可控制

### API服务
- **吞吐量适用条件**  
  - `峰值QPS ≤ 5000`（任意1分钟窗口）  
    - *注：* 此为SLO生效前提条件，非SLO目标
- **可用性**  
  - `服务可用率 ≥ 99.9%`（28天滚动窗口）  
    - *定义：* (1 - (5xx错误 + 超时失败请求数) / 总请求数)
- **延迟**  
  - `核心链路 P99延迟 ≤ 200ms`（1小时滚动窗口，按流量加权）
  - `常规接口 P99延迟 ≤ 500ms`（1小时滚动窗口，按流量加权）

### 数据服务
- **吞吐量适用条件**  
  - `峰值QPS ≤ 500`（任意5分钟窗口）
    - *注：* 此为SLO生效前提条件，非SLO目标 
- **可用性**  
  - `查询可用率 ≥ 99%`（28天滚动窗口）  
    - *定义：* (1 - (5xx错误 + 超时失败) / 总查询请求数)  
  - `数据有效性 ≥ 99%`（28天滚动窗口）  
    - *定义：* (返回数据通过完整性校验的请求数 / 成功响应请求数)  
- **延迟**  
  - `实时查询 P95延迟 ≤ 1000ms`（1小时滚动窗口）  
  - `离线查询 P95延迟 ≤ 5s`（24小时滚动窗口）
- **数据时效性**  
  - `端到端数据延迟 ≤ 5s (P99)`（1小时滚动窗口）  
    - *定义：* 从数据产生到可查询的耗时  
